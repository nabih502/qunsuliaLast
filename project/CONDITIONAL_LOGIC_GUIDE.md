# دليل المنطق الشرطي وإدارة المتطلبات والمرفقات

## نظرة عامة

تم إضافة نظام متكامل لإدارة المتطلبات والمرفقات بشكل ديناميكي مع دعم كامل للمنطق الشرطي (Conditional Logic) وإعادة الترتيب عبر السحب والإفلات (Drag & Drop).

## الميزات الرئيسية

### 1. المنطق الشرطي (Conditional Logic)
يمكنك تحديد متى يظهر كل متطلب أو مرفق بناءً على اختيارات المستخدم في الحقول الأخرى.

### 2. السحب والإفلات (Drag & Drop)
يمكنك إعادة ترتيب المتطلبات والمرفقات بسهولة عبر السحب والإفلات.

### 3. إدارة ديناميكية
إدارة كاملة لقسم "تفاصيل الخدمة" الذي سيظهر للمستخدم عند تقديم الطلب.

---

## كيفية الاستخدام

### الخطوة 1: إضافة الحقول في النموذج

قبل إضافة الشروط، تأكد من إنشاء الحقول في تبويب **"الحقول والنماذج"**:

1. انتقل إلى تبويب "الحقول والنماذج"
2. أضف الحقول التي سيختار منها المستخدم (مثل: نوع التوكيل، نوع الجواز، إلخ)
3. احفظ التغييرات

**مثال على الحقول:**
```
حقل 1:
- الاسم: service_type
- التسمية: نوع التوكيل
- النوع: قائمة منسدلة (select)
- الخيارات:
  * عقارات (real-estate)
  * سيارات (vehicles)
  * شركات (companies)

حقل 2:
- الاسم: passport_type
- التسمية: نوع الجواز
- النوع: اختيار واحد (radio)
- الخيارات:
  * جديد (new)
  * تجديد (renewal)
```

### الخطوة 2: إضافة المتطلبات مع الشروط

1. انتقل إلى تبويب **"المتطلبات"**
2. انقر على **"إضافة متطلب"**
3. أدخل نص المتطلب (عربي وإنجليزي)
4. انقر على أيقونة **الإعدادات** (⚙️) لإضافة شروط

#### مثال 1: متطلب خاص بالعقارات فقط

```
المتطلب: صورة من صك الملكية
الشرط:
- الحقل: service_type (نوع التوكيل)
- المعامل: = يساوي
- القيمة: real-estate (عقارات)
```

**النتيجة:** سيظهر هذا المتطلب فقط عندما يختار المستخدم "عقارات" في حقل نوع التوكيل.

#### مثال 2: متطلب خاص بالسيارات أو الشركات

```
المتطلب: صورة من الرخصة
الشرط:
- المنطق: أي شرط (OR)
- الشرط 1:
  * الحقل: service_type
  * المعامل: = يساوي
  * القيمة: vehicles
- الشرط 2:
  * الحقل: service_type
  * المعامل: = يساوي
  * القيمة: companies
```

**النتيجة:** سيظهر هذا المتطلب عندما يختار المستخدم "سيارات" أو "شركات".

#### مثال 3: شروط متعددة (AND)

```
المتطلب: صورة من الجواز القديم
الشرط:
- المنطق: جميع الشروط (AND)
- الشرط 1:
  * الحقل: passport_type
  * المعامل: = يساوي
  * القيمة: renewal
- الشرط 2:
  * الحقل: has_old_passport
  * المعامل: = يساوي
  * القيمة: yes
```

**النتيجة:** سيظهر هذا المتطلب فقط إذا كان نوع الجواز "تجديد" **و** المستخدم أجاب بـ "نعم" على سؤال "هل لديك جواز قديم؟".

### الخطوة 3: إضافة المرفقات مع الشروط

تعمل المرفقات بنفس طريقة المتطلبات:

1. انتقل إلى تبويب **"المستندات"**
2. انقر على **"إضافة مستند"**
3. أدخل تفاصيل المستند
4. انقر على أيقونة **الإعدادات** (⚙️) لإضافة شروط

#### مثال: مرفق خاص بالعقارات

```
المستند: صك الملكية
نوع الملف: PDF, JPG, PNG
الحجم الأقصى: 5 MB
إجباري: نعم

الشرط:
- الحقل: service_type
- المعامل: = يساوي
- القيمة: real-estate
```

### الخطوة 4: إعادة الترتيب

لإعادة ترتيب المتطلبات أو المرفقات:

1. اضغط مع الاستمرار على أيقونة **السحب** (⣿) بجانب العنصر
2. اسحب العنصر للأعلى أو الأسفل
3. أفلت الماوس في الموقع المطلوب
4. سيتم إعادة ترتيب العناصر تلقائياً

---

## المعاملات المتاحة

| المعامل | الرمز | الوصف | مثال |
|---------|------|-------|------|
| **يساوي** | = | القيمة تساوي القيمة المحددة | النوع = "عقارات" |
| **لا يساوي** | ≠ | القيمة لا تساوي القيمة المحددة | النوع ≠ "سيارات" |
| **يحتوي على** | ⊃ | النص يحتوي على القيمة | الاسم يحتوي على "محمد" |
| **لا يحتوي على** | ⊅ | النص لا يحتوي على القيمة | البريد لا يحتوي على "@" |
| **أكبر من** | > | القيمة الرقمية أكبر من | العمر > 18 |
| **أقل من** | < | القيمة الرقمية أقل من | العمر < 60 |
| **فارغ** | ∅ | الحقل فارغ (لم يتم ملؤه) | الملاحظات فارغة |
| **غير فارغ** | ∃ | الحقل تم ملؤه | رقم الجوال غير فارغ |

---

## أمثلة تطبيقية كاملة

### مثال 1: خدمة توكيلات متعددة الأنواع

#### الحقول:
1. **نوع التوكيل** (service_type) - قائمة منسدلة
   - عقارات
   - سيارات
   - محاكم
   - شركات

#### المتطلبات:

**متطلب عام (يظهر دائماً):**
- صورة من الهوية الوطنية
- بدون شروط ✓

**متطلبات خاصة بالعقارات:**
- صورة من صك الملكية
  - الشرط: نوع التوكيل = عقارات
- خريطة الموقع
  - الشرط: نوع التوكيل = عقارات

**متطلبات خاصة بالسيارات:**
- صورة من رخصة السيارة
  - الشرط: نوع التوكيل = سيارات
- صورة من استمارة السيارة
  - الشرط: نوع التوكيل = سيارات

**متطلبات خاصة بالمحاكم:**
- رقم القضية
  - الشرط: نوع التوكيل = محاكم
- صورة من حكم المحكمة (إن وجد)
  - الشرط: نوع التوكيل = محاكم

#### المرفقات:

**مرفق عام:**
- صورة الهوية
  - بدون شروط ✓

**مرفقات خاصة بالعقارات:**
- صك الملكية
  - الشرط: نوع التوكيل = عقارات

**مرفقات خاصة بالسيارات:**
- رخصة السيارة
  - الشرط: نوع التوكيل = سيارات

---

### مثال 2: خدمة جوازات السفر

#### الحقول:
1. **نوع الطلب** (request_type)
   - جواز جديد
   - تجديد
   - بدل فاقد

2. **هل لديك جواز قديم؟** (has_old_passport)
   - نعم
   - لا

#### المتطلبات:

**متطلبات عامة:**
- صورة شخصية
- صورة من الهوية

**متطلبات التجديد:**
- رقم الجواز القديم
  - الشرط: نوع الطلب = تجديد

**متطلبات بدل الفاقد:**
- بلاغ فقدان من الشرطة
  - الشرط: نوع الطلب = بدل فاقد

**متطلب مركب:**
- صورة من الجواز القديم
  - المنطق: جميع الشروط (AND)
  - الشرط 1: نوع الطلب = تجديد
  - الشرط 2: هل لديك جواز قديم = نعم

---

## نصائح مهمة

### 1. التخطيط المسبق
- خطط للحقول والشروط قبل البدء
- ارسم مخطط للخدمة والحالات المختلفة
- حدد المتطلبات العامة والخاصة

### 2. الحقول المطلوبة للشروط
- تأكد من إنشاء جميع الحقول في تبويب "الحقول والنماذج" أولاً
- استخدم أسماء واضحة للحقول باللغة الإنجليزية
- أضف جميع الخيارات الممكنة لكل حقل

### 3. الشروط البسيطة أولاً
- ابدأ بشروط بسيطة (حقل واحد)
- ثم انتقل للشروط المركبة (أكثر من حقل)
- اختبر كل شرط على حدة

### 4. التسميات الواضحة
- استخدم أسماء واضحة للمتطلبات والمرفقات
- أضف علامة "شرطي" للعناصر ذات الشروط (تظهر تلقائياً)

### 5. الترتيب المنطقي
- رتب المتطلبات بترتيب منطقي
- ضع المتطلبات العامة أولاً
- ثم المتطلبات الخاصة

### 6. الاختبار
- اختبر الخدمة بعد الحفظ
- جرب جميع السيناريوهات الممكنة
- تأكد من ظهور المتطلبات الصحيحة

---

## الأسئلة الشائعة

### س: هل يمكن إضافة أكثر من شرط لنفس العنصر؟
**ج:** نعم! يمكنك إضافة عدة شروط واختيار المنطق:
- **جميع الشروط (AND)**: يجب أن تتحقق جميع الشروط
- **أي شرط (OR)**: يكفي تحقق أي شرط واحد

### س: ماذا يحدث إذا لم أضف شروط؟
**ج:** العنصر سيظهر دائماً للمستخدم (متطلب/مرفق إجباري).

### س: هل يمكن إخفاء حقل بناءً على حقل آخر؟
**ج:** نعم! في تبويب "الحقول والنماذج"، يمكنك إضافة شروط لكل حقل أيضاً.

### س: كيف أحذف شرط؟
**ج:** انقر على أيقونة سلة المهملات بجانب الشرط.

### س: هل يمكن نسخ متطلب بشروطه؟
**ج:** حالياً لا، لكن يمكنك إضافة متطلب جديد ونسخ الشروط يدوياً.

### س: كيف أعرف أن العنصر له شروط؟
**ج:** سيظهر badge أزرق بكلمة "شرطي" بجانب اسم العنصر.

---

## الدعم الفني

إذا واجهت أي مشاكل:
1. تأكد من إنشاء الحقول أولاً
2. تحقق من أسماء الحقول والقيم (حساسة لحالة الأحرف)
3. اختبر الشروط بسيناريوهات مختلفة
4. راجع هذا الدليل

للمزيد من المساعدة، تواصل مع فريق الدعم الفني.
