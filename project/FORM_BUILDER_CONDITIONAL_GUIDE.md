# 🎨 دليل إضافة الشروط من Form Builder

## 📋 نظرة عامة

يمكنك الآن إضافة **شروط عرض** لأي حقل في النموذج مباشرة من Form Builder، مما يجعل الحقول تظهر أو تختفي بناءً على اختيارات المستخدم.

---

## 🚀 البداية السريعة

### الخطوات الأساسية:

```
1. افتح Form Builder
2. أضف الحقول إلى النموذج
3. اختر حقل تريد إضافة شرط له
4. اضغط تبويب "Rules"
5. اضغط "إضافة شرط للعرض"
6. حدد الشرط
7. احفظ!
```

---

## 🎯 الخطوات التفصيلية

### 1️⃣ افتح Form Builder

انتقل إلى صفحة تحرير الخدمة:

```
/admin/services/:serviceId/edit
```

أو:
- اذهب لإدارة الخدمات
- اضغط "تحرير" على أي خدمة
- اختر تبويب "الحقول والنماذج"

---

### 2️⃣ أضف الحقول الأساسية

من القائمة اليسرى، اسحب الحقول إلى النموذج:

```
╔══════════════════╗
║ Components       ║
╠══════════════════╣
║ 📝 Input         ║ ← اسحب
║ 📋 Dropdown      ║
║ 🔘 Radio group   ║
║ ☑️ Checkbox      ║
║ 📅 DatePicker    ║
╚══════════════════╝
```

**مثال:** لنضيف حقلين:

```
الحقل الأول:
- النوع: Radio group
- الاسم: passportType
- التسمية: نوع الطلب
- الخيارات:
  • جديد (new)
  • تجديد (renewal)
  • بدل فاقد (replacement)

الحقل الثاني:
- النوع: Text Input
- الاسم: oldPassportNumber
- التسمية: رقم الجواز القديم
```

---

### 3️⃣ اختر الحقل الذي تريد إضافة شرط له

اضغط على الحقل في النموذج (الحقل الثاني مثلاً):

```
╔════════════════════════════╗
║ Properties            ✕ 🗑 ║
╠════════════════════════════╣
║ [Main] [Style] [Actions]  ║
║ [Rules] ← اضغط هنا         ║
╚════════════════════════════╝
```

---

### 4️⃣ افتح تبويب "Rules"

ستظهر لك الواجهة التالية:

```
┌────────────────────────────────────┐
│ 💡 شروط العرض: حدد متى يظهر      │
│    هذا الحقل بناءً على قيم حقول │
│    أخرى                           │
└────────────────────────────────────┘

┌────────────────────────────────────┐
│        🔔                          │
│   هذا العنصر سيظهر دائماً         │
│                                    │
│   [➕ إضافة شرط للعرض]            │
└────────────────────────────────────┘
```

---

### 5️⃣ اضغط "إضافة شرط للعرض"

ستظهر واجهة بناء الشروط:

```
┌──────────────────────────────────┐
│ شروط العرض    المنطق: [OR ▼]   │
├──────────────────────────────────┤
│ إذا                          [🗑] │
│                                  │
│ الحقل:    [اختر حقل... ▼]       │
│ المعامل:  [يساوي ▼]             │
│ القيمة:   [اختر... ▼]           │
└──────────────────────────────────┘

[+ إضافة شرط آخر]

┌──────────────────────────────────┐
│ 📘 المعاينة: هذا العنصر سيظهر   │
│    عندما يتحقق أي شرط           │
└──────────────────────────────────┘
```

---

### 6️⃣ حدد الشرط

**مثال: إظهار حقل "رقم الجواز القديم" عند التجديد فقط**

```
الحقل: ▼
┌─────────────────────────┐
│ passportType (نوع الطلب)│ ← اختر هذا
│ fullName (الاسم الكامل) │
│ birthDate (تاريخ الميلاد)│
└─────────────────────────┘

المعامل: ▼
┌──────────────┐
│ يساوي        │ ← اختر هذا
│ لا يساوي     │
│ يحتوي على    │
└──────────────┘

القيمة: ▼
┌──────────────┐
│ جديد (new)   │
│ تجديد (renewal) │ ← اختر هذا
│ بدل فاقد     │
└──────────────┘
```

✅ **النتيجة:**
```
الشرط النهائي:
إذا نوع الطلب = تجديد
```

---

## 🎨 أمثلة عملية

### مثال 1️⃣: شرط بسيط

**السيناريو:** إظهار حقل "رقم الجواز القديم" عند التجديد فقط

```
الحقول:
┌─────────────────────────────────────┐
│ 1. نوع الطلب (passportType)        │
│    ○ جديد  ○ تجديد  ○ بدل فاقد    │
├─────────────────────────────────────┤
│ 2. رقم الجواز القديم ← شرطي       │
│    [P12345678_____________]         │
└─────────────────────────────────────┘

الشرط على الحقل 2:
├─ إذا
├─ الحقل: passportType
├─ المعامل: يساوي
└─ القيمة: renewal
```

**التجربة:**
```
عند اختيار "جديد":
┌─────────────────────────────────────┐
│ 1. نوع الطلب                       │
│    ● جديد  ○ تجديد  ○ بدل فاقد    │
└─────────────────────────────────────┘
← الحقل 2 مخفي ✓

عند اختيار "تجديد":
┌─────────────────────────────────────┐
│ 1. نوع الطلب                       │
│    ○ جديد  ● تجديد  ○ بدل فاقد    │
├─────────────────────────────────────┤
│ 2. رقم الجواز القديم               │
│    [P12345678_____________]         │
└─────────────────────────────────────┘
← الحقل 2 ظهر ✓
```

---

### مثال 2️⃣: شرطان مع OR

**السيناريو:** إظهار "رقم الجواز القديم" عند التجديد **أو** البدل فاقد

```
الشروط:
┌──────────────────────────────────┐
│ المنطق: [أي شرط (OR)]           │
├──────────────────────────────────┤
│ إذا                          [🗑] │
│ الحقل: passportType              │
│ المعامل: يساوي                  │
│ القيمة: renewal                  │
├──────────────────────────────────┤
│ أو                           [🗑] │
│ الحقل: passportType              │
│ المعامل: يساوي                  │
│ القيمة: replacement              │
└──────────────────────────────────┘
```

**التجربة:**
```
جديد → مخفي ✓
تجديد → ظاهر ✓
بدل فاقد → ظاهر ✓
```

---

### مثال 3️⃣: شرطان مع AND

**السيناريو:** إظهار "الرقم الوطني" للبالغين عند الإصدار الجديد فقط

```
الحقول:
1. هل أنت بالغ؟ (isAdult)
   ○ نعم  ○ لا

2. نوع الطلب (passportType)
   ○ جديد  ○ تجديد

3. الرقم الوطني (nationalId)
   [1234567890_______] ← شرطي

الشروط على الحقل 3:
┌──────────────────────────────────┐
│ المنطق: [كل الشروط (AND)]       │
├──────────────────────────────────┤
│ إذا                          [🗑] │
│ الحقل: isAdult                   │
│ المعامل: يساوي                  │
│ القيمة: yes                      │
├──────────────────────────────────┤
│ و                            [🗑] │
│ الحقل: passportType              │
│ المعامل: يساوي                  │
│ القيمة: new                      │
└──────────────────────────────────┘
```

**التجربة:**
```
بالغ + جديد → ظاهر ✓
بالغ + تجديد → مخفي ✓
طفل + جديد → مخفي ✓
طفل + تجديد → مخفي ✓
```

---

## 🔧 المعاملات المتاحة

| المعامل | الاستخدام | مثال |
|---------|-----------|------|
| **يساوي** | القيمة مطابقة تماماً | `نوع الطلب = "تجديد"` |
| **لا يساوي** | القيمة مختلفة | `نوع الطلب ≠ "جديد"` |
| **يحتوي على** | النص يحتوي على الكلمة | `الاسم يحتوي على "محمد"` |
| **موجود في القائمة** | القيمة ضمن قائمة | `الحالة في ["pending", "approved"]` |

---

## 💡 نصائح مهمة

### ✅ افعل:

1. **رتب الحقول بشكل صحيح**
   ```
   ✓ الصحيح:
   1. نوع الطلب (الحقل المرجعي)
   2. رقم الجواز القديم (الحقل الشرطي)
   ```

2. **استخدم أسماء واضحة**
   ```
   ✓ الصحيح:
   - passportType
   - isAdult
   - nationalId

   ✗ خطأ:
   - field1
   - f2
   - x
   ```

3. **استخدم قيم إنجليزية**
   ```
   ✓ الصحيح: value: "renewal"
   ✗ خطأ: value: "تجديد"
   ```

### ⚠️ لا تفعل:

1. **شروط دائرية**
   ```
   ✗ خطأ:
   - الحقل A يعتمد على B
   - الحقل B يعتمد على A
   ```

2. **شروط معقدة جداً**
   ```
   ⚠️ تجنب أكثر من 4 شروط لنفس الحقل
   ```

---

## 🧪 الاختبار

بعد إضافة الشروط:

```
1. اضغط Save في أعلى الصفحة
2. افتح صفحة الخدمة: /service/:slug
3. جرب تغيير الاختيارات
4. راقب الحقول تظهر/تختفي ⚡
```

---

## 🎬 سير العمل الكامل

```
Form Builder
    ↓
أضف الحقل الأول (المرجعي)
    ↓
أضف الحقل الثاني (الشرطي)
    ↓
اختر الحقل الثاني
    ↓
Properties → Rules
    ↓
إضافة شرط
    ↓
حدد: الحقل + المعامل + القيمة
    ↓
Save
    ↓
اختبر على الموقع ✓
```

---

## 📸 صور توضيحية

### واجهة Form Builder

```
┌─────────────┬────────────────────────┬──────────────┐
│ Components  │   Form Canvas          │ Properties   │
│             │                        │              │
│ 📝 Input    │  ┌──────────────────┐  │ [Main]       │
│ 📋 Dropdown │  │ نوع الطلب        │  │ [Style]      │
│ 🔘 Radio    │  │ ○ جديد           │  │ [Actions]    │
│ ☑️ Checkbox │  │ ○ تجديد          │  │ [Rules] ✓    │
│             │  └──────────────────┘  │              │
│             │                        │ شروط العرض:  │
│             │  ┌──────────────────┐  │              │
│             │  │ رقم الجواز       │  │ إذا:         │
│             │  │ [P123456____]    │  │ نوع الطلب   │
│             │  └──────────────────┘  │ = تجديد      │
│             │                        │              │
└─────────────┴────────────────────────┴──────────────┘
```

---

## ✨ الخلاصة

**في 6 خطوات فقط:**

```
1. افتح Form Builder
2. أضف الحقول
3. اختر الحقل الشرطي
4. Rules → إضافة شرط
5. حدد الشرط
6. Save!
```

الآن يمكنك إنشاء نماذج ذكية تتكيف مع المستخدم! 🎉
