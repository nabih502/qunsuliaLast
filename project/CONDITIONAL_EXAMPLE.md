# مثال عملي: نظام العرض الشرطي

## 🎯 السيناريو: خدمة الجوازات

المستخدم يزور صفحة `/service/passports`

---

## 1️⃣ المستخدم يختار: "البالغ" و "تجديد"

```javascript
formValues = {
  isAdult: "yes",
  passportType: "renewal"
}
```

### ✅ المتطلبات التي ستظهر:

```
✓ الجواز القديم الأصلي
✓ نسخة إلكترونية من الجواز القديم
✓ صورة شخصية حديثة
✓ حضور مقدم الطلب لمكتب تصوير الجوازات بالقنصلية
```

### ✅ المستندات التي ستظهر:

```
📄 صورة من الجواز (مطلوبة)
📄 الصورة الشخصية (مطلوبة)
```

### ✅ الحقول التي ستظهر:

```
┌─────────────────────────────────┐
│ هل المتقدم بالغ (18 سنة فأكثر)؟ │
│ ● نعم  ○ لا                     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ نوع الطلب                       │
│ ● جواز جديد                     │
│ ● تجديد ✓                       │
│ ● بدل فاقد                      │
│ ● وثيقة سفر اضطرارية            │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ رقم الجواز القديم               │
│ [P12345678_______________]      │
│ مثال: P12345678                 │
└─────────────────────────────────┘
```

---

## 2️⃣ المستخدم يغيّر إلى: "البالغ" و "بدل فاقد"

```javascript
formValues = {
  isAdult: "yes",
  passportType: "replacement"
}
```

### ✅ المتطلبات التي ستظهر الآن:

```
✓ شهادة فقدان صادرة من أقرب قسم شرطة
✓ نسخة من الجواز المفقود (إن وجدت)
✓ صورة شخصية حديثة
✓ حضور مقدم الطلب لمكتب تصوير الجوازات بالقنصلية
```

### ✅ المستندات تتغير إلى:

```
📄 صورة من الجواز (مطلوبة)
📄 الصورة الشخصية (مطلوبة)
📄 شهادة الفقدان (مطلوبة) ← جديد!
```

### ✅ الحقول الجديدة:

```
┌─────────────────────────────────┐
│ رقم الجواز القديم               │
│ [P12345678_______________]      │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ مكان الفقدان ← جديد!            │
│ [الرياض_______________]         │
└─────────────────────────────────┘
```

---

## 3️⃣ المستخدم يغيّر إلى: "طفل" و "جواز جديد"

```javascript
formValues = {
  isAdult: "no",
  passportType: "new"
}
```

### ✅ المتطلبات تتغير تماماً:

```
✓ صورة من الجواز
✓ صورة من جواز الوصي (الأم والأب)
✓ يجب حضور الوالد وفي حالة عدم وجوده إحضار خطاب عدم ممانعة
✓ حضور مقدم الطلب لمكتب تصوير الجوازات بالقنصلية
```

### ✅ المستندات تتغير:

```
📄 صورة من الجواز (مطلوبة)
📄 صورة جواز الأم (مطلوبة) ← جديد!
📄 صورة جواز الأب (مطلوبة) ← جديد!
📄 صورة شخصية للطفل (مطلوبة)
```

### ✅ حقل جديد يظهر:

```
┌─────────────────────────────────┐
│ إحضار خطاب عدم ممانعة من الوالد│
│ ● نعم، سيتم إحضاره             │
│ ○ لا حاجة، الوالد سيحضر شخصياً  │
└─────────────────────────────────┘
```

---

## 4️⃣ وثيقة سفر اضطرارية

```javascript
formValues = {
  isAdult: "yes",
  passportType: "emergency"
}
```

### ✅ حقول إضافية كثيرة تظهر:

```
┌─────────────────────────────────┐
│ سبب طلب وثيقة السفر الاضطرارية │
│ [_________________________]     │
│ [_________________________]     │
│ يرجى توضيح السبب الطارئ         │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ محل الميلاد                     │
│ [الخرطوم_______________]        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ تاريخ الميلاد                   │
│ [📅 01/01/1990_________]        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ الطول (سم)                      │
│ [175_________________]           │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ لون العيون                      │
│ ▼ [بني_____________]            │
│   • أسود                        │
│   • بني                         │
│   • أخضر                        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ لون الشعر                       │
│ ▼ [أسود____________]            │
│   • أسود                        │
│   • بني                         │
│   • رمادي/شايب                  │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ العلامات المميزة (اختياري)     │
│ [شامة على الخد الأيسر____]     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ أفراد العائلة                   │
│ ┌──────────────────────────┐    │
│ │ الاسم: أحمد محمد          │    │
│ │ تاريخ الميلاد: 01/01/2010│    │
│ │ صلة القرابة: ابن          │    │
│ └──────────────────────────┘    │
│ [+ إضافة فرد آخر]               │
└─────────────────────────────────┘
```

---

## 📊 الكود في قاعدة البيانات

### جدول service_fields:

```sql
-- حقل رقم الجواز القديم
{
  "field_name": "oldPassportNumber",
  "label_ar": "رقم الجواز القديم",
  "field_type": "text",
  "is_required": true,
  "conditions": {
    "show_when": [
      {"field": "passportType", "operator": "equals", "value": "renewal"},
      {"field": "passportType", "operator": "equals", "value": "replacement"}
    ],
    "logic": "OR"
  }
}

-- حقل مكان الفقدان
{
  "field_name": "lossLocation",
  "label_ar": "مكان الفقدان",
  "field_type": "text",
  "is_required": true,
  "conditions": {
    "show_when": [
      {"field": "passportType", "operator": "equals", "value": "replacement"}
    ],
    "logic": "OR"
  }
}
```

### جدول service_documents:

```sql
-- مستند جواز الأم (للأطفال فقط)
{
  "document_name_ar": "صورة جواز الأم",
  "is_required": true,
  "conditions": {
    "show_when": [
      {"field": "isAdult", "operator": "equals", "value": "no"},
      {"field": "passportType", "operator": "equals", "value": "new"}
    ],
    "logic": "AND"  -- يحتاج كلا الشرطين
  }
}
```

### جدول service_requirements:

```sql
-- متطلب للقصر
{
  "requirement_ar": "صورة من جواز الوصي (الأم والأب)",
  "conditions": {
    "show_when": [
      {"field": "isAdult", "operator": "equals", "value": "no"}
    ],
    "logic": "OR"
  }
}
```

---

## 🔄 التحديث التلقائي

```javascript
// عند تغيير أي حقل
watch('passportType') → triggers re-evaluation
                      ↓
        evaluateConditions() يتم استدعاء
                      ↓
              فلترة العناصر المرئية
                      ↓
        تحديث الواجهة فوراً (React re-render)
```

---

## 🎨 الواجهة المرئية

```
╔════════════════════════════════════════════════════════════╗
║  🔵 جوازات السفر                                          ║
║  إصدار وتجديد جوازات السفر السودانية                     ║
╠════════════════════════════════════════════════════════════╣
║                                                            ║
║  ┌─ الخطوة 1 ──────────────── الخطوة 2 ─────────────┐   ║
║  │ تفاصيل الجواز ✓      المستندات المطلوبة         │   ║
║  └─────────────────────────────────────────────────────┘   ║
║                                                            ║
║  ┌──────────────────────┐  ┌────────────────────────────┐ ║
║  │                      │  │  📋 المتطلبات              │ ║
║  │  [النموذج هنا]      │  │  ✓ متطلب 1                │ ║
║  │                      │  │  ✓ متطلب 2                │ ║
║  │  الحقول تتغير      │  │  ✓ متطلب 3                │ ║
║  │  حسب الاختيارات    │  │                            │ ║
║  │                      │  │  📄 المستندات المطلوبة    │ ║
║  │                      │  │  📎 مستند 1 (إلزامي)      │ ║
║  │                      │  │  📎 مستند 2 (إلزامي)      │ ║
║  │                      │  │                            │ ║
║  │                      │  │  💰 الرسوم                │ ║
║  │                      │  │  930 ريال سعودي          │ ║
║  │                      │  │                            │ ║
║  │  [السابق] [التالي]  │  │  ⏱ مدة الإنجاز           │ ║
║  │                      │  │  5-7 أيام عمل             │ ║
║  └──────────────────────┘  └────────────────────────────┘ ║
╚════════════════════════════════════════════════════════════╝
```

---

## 🚀 الاستخدام

```bash
# 1. نسخ البيانات من الكونفيج
npm run sync-services

# 2. الوصول للخدمة
http://localhost:5173/service/passports

# 3. جرّب تغيير الاختيارات وشاهد العناصر تتغير فوراً!
```

---

## ✨ المميزات

- ✅ **ديناميكي 100%**: كل شيء من قاعدة البيانات
- ✅ **تحديث فوري**: بدون تحديث الصفحة
- ✅ **سهل الصيانة**: تعديل من لوحة الإدارة
- ✅ **مرن**: دعم شروط معقدة (AND/OR)
- ✅ **قابل للتوسع**: إضافة operators جديدة بسهولة
