# نظام الشات بوت الذكي

## نظرة عامة

تم إنشاء نظام شات بوت ذكي ومتكامل يساعد المواطنين في:
- الاستعلام عن المعاملات
- التواصل مع الموظفين المختصين
- الحصول على معلومات عن الخدمات
- الدعم الفوري حسب نوع الخدمة

## المكونات الرئيسية

### 1. قاعدة البيانات
تم إنشاء 3 جداول في Supabase:

#### `chat_conversations` - المحادثات
- معلومات المستخدم (الاسم، البريد، الهاتف)
- نوع الخدمة والفئة
- حالة المحادثة (active, waiting, closed)
- الموظف المسؤول

#### `chat_messages` - الرسائل
- نص الرسالة
- نوع المرسل (user, bot, staff)
- التوقيت
- حالة القراءة

#### `chat_staff` - موظفي الدعم
- معلومات الموظف
- فئات الخدمات المسؤول عنها
- حالة الاتصال (online/offline)

### 2. مكون الشات بوت (`ChatBot.tsx`)

#### المميزات:
- **ذكي وسياقي**: يفهم نوع الخدمة التي يتصفحها المستخدم
- **تفاعلي في الوقت الفعلي**: باستخدام Supabase Realtime
- **إجراءات سريعة**: أزرار للاستعلام والتواصل مع موظف
- **تصميم عصري**: يتناسب مع ألوان الموقع (أخضر/تركواز)

#### الاستخدام:
```jsx
// صفحة عادية
<ChatBot />

// صفحة خدمة محددة
<ChatBot serviceCategory="education" />

// خدمة فرعية
<ChatBot serviceCategory="poa" serviceType="general" />
```

### 3. لوحة إدارة المحادثات (`ChatManagement.jsx`)

#### الوظائف:
- عرض جميع المحادثات (نشطة، انتظار، مغلقة)
- إحصائيات شاملة
- الرد على المواطنين
- إغلاق المحادثات
- تصفية حسب الحالة

#### الوصول:
`/admin/chat`

### 4. إدارة موظفي الدعم (`ChatStaffManagement.jsx`)

#### الوظائف:
- إضافة موظفين جدد
- تحديد فئات الخدمات لكل موظف
- إدارة حالة الاتصال (online/offline)
- حذف الموظفين

#### الوصول:
`/admin/chat-staff`

## كيفية العمل

### 1. بدء المحادثة
- المستخدم يملأ بياناته (الاسم، البريد، الهاتف)
- يتم إنشاء محادثة جديدة في قاعدة البيانات
- الشات بوت يرحب بالمستخدم ويعرض خيارات حسب السياق

### 2. الذكاء السياقي
- إذا كان المستخدم في صفحة التعليم، يعرض خيارات تعليمية
- إذا كان في صفحة التوكيلات، يعرض خيارات التوكيلات
- إذا كان في الصفحة الرئيسية، يعرض خيارات عامة

### 3. التواصل مع موظف
- عندما يطلب المستخدم التواصل مع موظف
- النظام يبحث عن موظف متاح (online)
- يخصص المحادثة لموظف مسؤول عن نفس فئة الخدمة
- الموظف يرى المحادثة في لوحة التحكم ويرد فوراً

### 4. الوقت الفعلي
- تحديثات فورية باستخدام Supabase Realtime
- المستخدم يرى رد الموظف فوراً
- الموظف يرى رسائل المستخدم فوراً

## التصميم والألوان

- **اللون الأساسي**: أخضر زمردي إلى تركواز (من `emerald-600` إلى `teal-600`)
- **الأيقونة**: رسالة دائرية (`MessageCircle`)
- **الموقع**: أسفل يمين الشاشة
- **الحجم**: 96x600 بكسل (responsive)

## الصفحات التي تحتوي على الشات بوت

1. **الصفحة الرئيسية** - شات بوت عام
2. **صفحة التعليم** - شات بوت للتعليم
3. **التوكيل العام** - شات بوت للتوكيلات العامة
4. **جوازات السفر** - شات بوت لجوازات السفر

يمكن إضافة الشات بوت لأي صفحة أخرى بسهولة!

## إضافة الشات بوت لصفحة جديدة

1. استيراد المكون:
```jsx
import ChatBot from '../components/ChatBot';
```

2. إضافته قبل إغلاق العنصر الرئيسي:
```jsx
<Footer />
<ChatBot serviceCategory="category_name" />
```

## إضافة موظف دعم جديد

1. اذهب إلى `/admin/chat-staff`
2. انقر على "إضافة موظف"
3. أدخل:
   - الاسم
   - البريد الإلكتروني
   - فئات الخدمات المسؤول عنها
4. احفظ

الموظف سيظهر في قائمة الموظفين ويمكنه الرد على المحادثات.

## الأمان

- جميع الجداول محمية بـ RLS (Row Level Security)
- المستخدمون العاديون: يمكنهم إنشاء محادثات وإرسال رسائل
- الموظفون: يمكنهم قراءة جميع المحادثات والرد عليها
- الإداريون: وصول كامل لجميع الوظائف

## التطوير المستقبلي

بعض الأفكار للتحسين:
- إضافة إشعارات للموظفين عند وصول رسالة جديدة
- تقييم الخدمة بعد انتهاء المحادثة
- تقارير وإحصائيات متقدمة
- دعم الملفات المرفقة
- قوالب جاهزة للردود السريعة
- بحث في المحادثات السابقة
