# ุฏููู ุงุณุชูุฑุงุฏ ุฌููุน ุจูุงูุงุช ุงูุฎุฏูุงุช ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## โ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุจูุฌุงุญ ุฅูุดุงุก ูุธุงู ุดุงูู ูุงุณุชูุณุงุฎ ุฌููุน ุจูุงูุงุช ุงูุฎุฏูุงุช ูู ูููุงุช `config.js` ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช Supabaseุ ุจูุง ูู ุฐูู:

### ๐ ุงูุจูุงูุงุช ุงูููุณุชูุณุฎุฉ:

1. **ูุนูููุงุช ุงูุฎุฏูุฉ ุงูุฃุณุงุณูุฉ**
   - ุงูุงุณู (ุนุฑุจู/ุฅูุฌููุฒู)
   - ุงููุตู
   - ุงูุฃููููุฉ
   - ุงูุชุตููู
   - ุงูุฑุณูู
   - ุงููุฏุฉ ุงููุชููุนุฉ

2. **ุงููุชุทูุจุงุช (Requirements)**
   - ุฌููุน ุงููุชุทูุจุงุช ูุน ุชุฑุชูุจูุง
   - **ุงูุดุฑูุท ุงูุฎุงุตุฉ ููู ูุชุทูุจ** (ูุซู: ููุน ุงูุทูุจุ ุนูุฑ ุงููุชูุฏู)
   - ุงูููุงุนุฏ ุงูุดุฑุทูุฉ ูุธููุฑ ุงููุชุทูุจุงุช

3. **ุงูุญููู (Fields)**
   - ุฌููุน ุญููู ุงูููุงุฐุฌ ุจุฃููุงุนูุง ุงููุฎุชููุฉ
   - ุงูุฎูุงุฑุงุช ูุงูููู ุงูุงูุชุฑุงุถูุฉ
   - ููุงุนุฏ ุงูุชุญูู (Validation Rules)
   - **ุงูููุงุนุฏ ุงูุดุฑุทูุฉ ุงููุงููุฉ** ุงูุชู ุชุชุญูู ูู ุธููุฑ/ุฅุฎูุงุก ุงูุญููู
   - ูุตูุต ุงููุณุงุนุฏุฉ

4. **ุญููู ุงูููุงุฆู ุงูุฏููุงููููุฉ (Dynamic List Fields)**
   - ุญููู "ุฃูุฑุงุฏ ุงูุนุงุฆูุฉ" ูุน ุชุงุฑูุฎ ุงููููุงุฏ ุงููููู ูู 3 ุญููู (ุงููููุ ุงูุดูุฑุ ุงูุณูุฉ)
   - ุฌููุน ุงูุญููู ุงููุฑุนูุฉ ููููุงุฆู ุงูุฏููุงููููุฉ

5. **ุงููุฑููุงุช (Documents)** โญ ูุญุฏูุซ
   - ุฌููุน ุงููุฑููุงุช ุงููุทููุจุฉ
   - ุงูุญุฏ ุงูุฃูุตู ูุญุฌู ุงูููู (ูุน ุฏุนู ุชูุณููุงุช ูุฎุชููุฉ: 5MB, 2MB)
   - ุฃููุงุน ุงููููุงุช ุงูููุจููุฉ
   - **ุงูููุงุนุฏ ุงูุดุฑุทูุฉ ุงููุงููุฉ** ูุธููุฑ ุงููุฑููุงุช (ุจุณูุทุฉ ููุนูุฏุฉ AND/OR)
   - ุชุญููู ุชููุงุฆู ููุดุฑูุท ุฅูู ุชูุณูู `show_when` ุงููุนูุงุฑู

### ๐ฏ ุงูุฎุฏูุงุช ุงูููุนุงูุฌุฉ (15 ุฎุฏูุฉ):

โ ุฌูุงุฒุงุช ุงูุณูุฑ (Passports)
โ ุงูุฅูุฑุงุฑุงุช (Declarations)
โ ุงูุฅูุฑุงุฑุงุช ุงูุนุงุฏูุฉ (Regular Declarations)
โ ุงูุฅูุฑุงุฑุงุช ุงููุดููุนุฉ ุจุงููููู (Sworn Declarations)
โ ุงูุชููููุงุช (Power of Attorney)
โ ุงูุชูุซูู (Attestations)
โ ุงูุฅูุงุฏุงุช (Endorsements)
โ ุงูุณุฌู ุงููุฏูู (Civil Registry)
โ ุงูุดุคูู ุงููุงููููุฉ ูุงูุฃุณุฑูุฉ (Family Affairs)
โ ุงูุชุฃุดูุฑุงุช (Visas)
โ ุงูุฎุฏูุงุช ุงูุชุนููููุฉ (Education)
โ ุงููุฃุฐูููุฉ (Madhoonia)
โ ุฎุทุงุจ ุณุชุฑ ุงูุฌุซูุงู (Body Covering)
โ ุจูู ุงูุฎุฑุทูู (Khartoom Bank)
โ ุงูุนูู ูุงูุณุฌูู (Work and Prisons)

## ๐ ุงููููุงุช ุงููููุดุฃุฉ:

### 1. ุณูุฑูุจุช ุชูููุฏ SQL
```
scripts/generate-import-sql.js
```
- ููุฑุฃ ุฌููุน ูููุงุช `config.js`
- ูุญูู ุงูุจูุงูุงุช ุฅูู SQL statements
- ูููุฏ migration ูุงูู

### 2. ููู Migration ุงูุดุงูู
```
supabase/migrations/99999999999999_import_all_services_data.sql
```
- ุญุฌู ุงูููู: 271 KB
- ุนุฏุฏ ุงูุฃุณุทุฑ: 3,036
- ูุญุชูู ุนูู ุฌููุน ุจูุงูุงุช ุงูู 15 ุฎุฏูุฉ

## ๐ ููููุฉ ุงูุชุทุจูู

### ุงูุทุฑููุฉ 1: ุนุจุฑ Supabase Dashboard (ุงูุฃุณูู)

1. ุงูุชุญ Supabase Dashboard
2. ุงูุชูู ุฅูู **SQL Editor**
3. ุงูุชุญ ุงูููู `supabase/migrations/99999999999999_import_all_services_data.sql`
4. ุงูุณุฎ ูุญุชูู ุงูููู ุจุงููุงูู
5. ุงูุตู ุงููุญุชูู ูู SQL Editor
6. ุงุถุบุท **Run**

### ุงูุทุฑููุฉ 2: ุนุจุฑ Supabase CLI

```bash
# ุฅุฐุง ูุงู ูุฏูู Supabase CLI ูุซุจุช
supabase db push
```

### ุงูุทุฑููุฉ 3: ุนุจุฑ pgAdmin ุฃู ุฃู ุฃุฏุงุฉ PostgreSQL

1. ุงุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช Supabase
2. ุงูุชุญ ุงูููู `99999999999999_import_all_services_data.sql`
3. ููุฐ ุงูููู ูุงููุงู

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ:

1. **services**
   - ุจูุงูุงุช ุงูุฎุฏูุงุช ุงูุฃุณุงุณูุฉ

2. **service_requirements**
   - ุงููุชุทูุจุงุช ูุน ุงูููุงุนุฏ ุงูุดุฑุทูุฉ

3. **service_fields**
   - ุญููู ุงูููุงุฐุฌ ูุน ุฌููุน ุงูุชูุงุตูู
   - `conditions` JSONB ููููุงุนุฏ ุงูุดุฑุทูุฉ

4. **service_dynamic_list_fields**
   - ุงูุญููู ุงููุฑุนูุฉ ููููุงุฆู ุงูุฏููุงููููุฉ

5. **service_documents**
   - ุงููุฑููุงุช ุงููุทููุจุฉ
   - `conditions` JSONB ููููุงุนุฏ ุงูุดุฑุทูุฉ

## ๐ ููุงุญุธุงุช ุฃูุงู RLS

Migration ูููู ุจู:
- ุงุณุชุฎุฏุงู `ON CONFLICT` ูุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
- ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ูุจู ุงูุฅุฏุฑุงุฌ
- ุงูุญูุงุธ ุนูู ุณูุงูุฉ ุงูุจูุงูุงุช

โ๏ธ **ููู**: ุฅุฐุง ูุงุฌูุช ูุดุงูู RLSุ ุชุฃูุฏ ูู ุชุดุบูู SQL ููุณุชุฎุฏู admin ุฃู ุนุจุฑ Supabase Dashboard ูุจุงุดุฑุฉ.

## ๐ ุฅุนุงุฏุฉ ุงูุชุทุจูู

ุฅุฐุง ุฃุฑุฏุช ุฅุนุงุฏุฉ ุชูููุฏ ุงูู SQL ุจุนุฏ ุชุนุฏูู ูููุงุช config.js:

```bash
node scripts/generate-import-sql.js
```

ุณูุชู ุฅูุดุงุก ููู migration ุฌุฏูุฏ ูุญู ูุญู ุงููุฏูู.

## โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุงูููุงุนุฏ ุงูุดุฑุทูุฉ ุงููุงููุฉ
- ุฌููุน ุงูุดุฑูุท ูู ูููุงุช config ูุญููุธุฉ ูู ุนููุฏ `conditions`
- ุชุฏุนู ุงูุดุฑูุท ุงูุจุณูุทุฉ ูุงููุนูุฏุฉ (AND/OR)

### 2. ุชุงุฑูุฎ ุงููููุงุฏ ุจุซูุงุซุฉ ุญููู
- ุงูููู (1-31)
- ุงูุดูุฑ (ููุงูุฑ-ุฏูุณูุจุฑ)
- ุงูุณูุฉ (100 ุณูุฉ ูุงุถูุฉ)

### 3. ุฎูุงุฑุงุช ูุงููุฉ
- ุฌููุน ุงูุฎูุงุฑุงุช ูู ูููุงุช config ูุญููุธุฉ
- ุชุฏุนู Select, Radio, Checkbox

### 4. Dynamic Lists
- ุญููู "ุฃูุฑุงุฏ ุงูุนุงุฆูุฉ"
- ุญููู "ุงูุฃุทูุงู"
- ุฃู ููุงุฆู ุฏููุงููููุฉ ุฃุฎุฑู

## ๐จ ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ูู ุงูุชุทุจูู

ุจุนุฏ ุชุทุจูู Migrationุ ููููู:

1. **ุนุฑุถ ุงูุฎุฏูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
```javascript
const { data: services } = await supabase
  .from('services')
  .select('*')
  .eq('is_active', true);
```

2. **ุนุฑุถ ุญููู ุฎุฏูุฉ ูุนููุฉ**
```javascript
const { data: fields } = await supabase
  .from('service_fields')
  .select('*, service_dynamic_list_fields(*)')
  .eq('service_id', serviceId)
  .order('order_index');
```

3. **ุนุฑุถ ุงููุฑููุงุช ูุน ุดุฑูุทูุง**
```javascript
const { data: documents } = await supabase
  .from('service_documents')
  .select('*')
  .eq('service_id', serviceId)
  .eq('is_active', true)
  .order('order_index');
```

4. **ุนุฑุถ ุงููุชุทูุจุงุช ูุน ุดุฑูุทูุง**
```javascript
const { data: requirements } = await supabase
  .from('service_requirements')
  .select('*')
  .eq('service_id', serviceId)
  .eq('is_active', true)
  .order('order_index');
```

5. **ุชุทุจูู ุงูููุงุนุฏ ุงูุดุฑุทูุฉ ููุญููู**
```javascript
// ุงูุชุญูู ูู ุดุฑูุท ุธููุฑ ุงูุญูู
function shouldShowField(field, formData) {
  if (!field.conditions || Object.keys(field.conditions).length === 0) {
    return true;
  }

  const condition = field.conditions;

  // ุดุฑูุท ุจุณูุทุฉ
  if (condition.field && condition.values) {
    return condition.values.includes(formData[condition.field]);
  }

  // ุดุฑูุท ูุนูุฏุฉ ูุน show_when
  if (condition.show_when && Array.isArray(condition.show_when)) {
    return evaluateShowWhen(condition.show_when, formData);
  }

  return true;
}

function evaluateShowWhen(showWhenGroups, formData) {
  // ูู ูุฌููุนุฉ ูู showWhen ุชููููู ุจุดูู ูููุตู (OR ุจูู ุงููุฌููุนุงุช)
  return showWhenGroups.some(group => {
    const operator = group.operator || 'OR';
    const conditions = group.conditions || [];

    if (operator === 'AND') {
      // ุฌููุน ุงูุดุฑูุท ูุฌุจ ุฃู ุชุชุญูู
      return conditions.every(cond =>
        cond.values.includes(formData[cond.field])
      );
    } else {
      // ุฃู ุดุฑุท ูุฌุจ ุฃู ูุชุญูู
      return conditions.some(cond =>
        cond.values.includes(formData[cond.field])
      );
    }
  });
}
```

6. **ุชุทุจูู ุงูููุงุนุฏ ุงูุดุฑุทูุฉ ูููุฑููุงุช ูุงููุชุทูุจุงุช**
```javascript
// ููุณ ุงูููุทู ูุทุจู ุนูู ุงููุฑููุงุช ูุงููุชุทูุจุงุช
function shouldShowDocument(document, formData) {
  return shouldShowField(document, formData);
}

function shouldShowRequirement(requirement, formData) {
  if (!requirement.conditions || Object.keys(requirement.conditions).length === 0) {
    return true;
  }

  // ุงููุชุทูุจุงุช ูุฏููุง ุดุฑูุท ุจุณูุทุฉ (ูุซู type: 'renewal')
  const conditions = requirement.conditions;

  // ูุซุงู: { type: 'renewal' }
  // ูุธูุฑ ุงููุชุทูุจ ููุท ุนูุฏูุง ูููู ููุน ุงูุทูุจ = renewal
  for (const [key, value] of Object.entries(conditions)) {
    if (formData[key] !== value) {
      return false;
    }
  }

  return true;
}
```

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ุชุทุจูู Migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุงุณุชูุฑุงุฏ
3. โญ๏ธ ุชุญุฏูุซ ุงูุชุทุจูู ููุฑุงุกุฉ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โญ๏ธ ุฅุถุงูุฉ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุฎุฏูุงุช ูู ููุญุฉ ุงูุชุญูู

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ RLS Policy
ุฅุฐุง ูุงุฌูุช:
```
new row violates row-level security policy
```

**ุงูุญู**: ุงุณุชุฎุฏู Supabase Dashboard SQL Editor ูุชูููุฐ SQLุ ููู ูุชุฌุงูุฒ RLS ุชููุงุฆูุงู.

### ุฎุทุฃ Foreign Key
ุฅุฐุง ูุงุฌูุช ูุดุงูู ูู Foreign Keys:
- ุชุฃูุฏ ูู ุชูููุฐ ุงูู statements ุจุงูุชุฑุชูุจ ุงูุตุญูุญ
- ุงูู migration ูุตูู ููุชูููุฐ ุงูุชุณูุณูู

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู logs ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุฃูุฏ ูู ูุฌูุฏ ุฌููุน ุงูุฌุฏุงูู ุงููุทููุจุฉ
3. ุชุญูู ูู RLS policies

---

**ุชู ุจูุฌุงุญ! ๐**

ุฌููุน ุจูุงูุงุช ุงูุฎุฏูุงุช ุฌุงูุฒุฉ ููุงุณุชูุฑุงุฏ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.
